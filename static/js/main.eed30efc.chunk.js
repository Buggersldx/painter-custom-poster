(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(t,e,a){t.exports=a(290)},139:function(t,e,a){},145:function(t,e){},146:function(t,e){},147:function(t,e){},148:function(t,e,a){},290:function(t,e,a){"use strict";a.r(e);var n=a(1),r=a.n(n),i=a(3),o=a.n(i);a(139),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c,s,d=a(26),l=a(13),h=a(21),u=a.n(h),p=a(48),b=a(117),f=a(118),g=a(132),v=a(119),m=a(23),x=a(131),S=a(120),w=a(121),y=a.n(w),O=a(70),j=a.n(O),k=a(122),C=a.n(k),E=[{type:"canvas",css:{width:"654",height:"1000",backgroundColor:"#f8f8f8"}},{type:"text",name:"\u6587\u5b57",css:{text:" \u6211\u662f\u6765\u6d4b\u8bd5\u7684,\u8bf7\u4f60\u4e0d\u8981\u6253\u6b7b\u6211",width:200,lineHeight:1.5,color:"red",top:0,left:100,background:"rgba(0,0,0,0)",fontSize:30,fontWeight:["normal","bold"],maxLines:2,textStyle:["fill","stroke"],textAlign:["left","center","right"],textDecoration:["none","overline","underline","linethrough"],borderRadius:1,borderWidth:1,borderColor:"#000000",padding:0,rotate:0,shadow:"10 10 5 #888888",fontFamily:""}},{type:"rect",name:"\u77e9\u5f62",css:{background:"#ffffff",top:300,left:100,width:500,height:100,rotate:0,borderRadius:50,borderWidth:2,borderColor:"#000000",shadow:"10 10 5 #888888"}},{type:"image",name:"\u56fe\u7247",css:{url:"https://operate.maiyariji.com/20190709%2F3da002983292a6950a71ca7392a21827.jpg",mode:["scaleToFill","aspectFill","auto"],top:100,left:100,width:100,height:100,rotate:0,borderRadius:50,borderWidth:2,borderColor:"#000000",shadow:""}},{type:"qrcode",name:"\u4e8c\u7ef4\u7801",css:{url:"\u54c8\u54c8\u54c8",color:"#000000",background:"#ffffff",top:100,left:100,width:200,rotate:0}}],R=(a(148),a(292)),W=a(295),I=a(31),B=a(293),A=a(294),D=a(123),F=a.n(D),N=a(94),_=a(124),Y=a.n(_),X=a(234),z=R.a.Option;fabric=y.a.fabric,W.a.config({maxCount:1});var L=2,U={canvasState:[],currentStateIndex:-1,undoStatus:!1,redoStatus:!1,undoFinishedStatus:1,redoFinishedStatus:1},H=j.a.cloneDeep(E);H[1].css.textStyle=H[1].css.textStyle[0],H[1].css.textAlign=H[1].css.textAlign[0],H[1].css.fontWeight=H[1].css.fontWeight[0],H[1].css.textDecoration=H[1].css.textDecoration[0],H[3].css.mode=H[3].css.mode[0];var J=(c=Object(N.b)(N.a),s=function(t){function e(t){var a;return Object(b.a)(this,e),(a=Object(g.a)(this,Object(v.a)(e).call(this,t))).showDrawer=function(){a.setState({visible:!0})},a.onClose=function(){a.setState({visible:!1})},a.handleSubmit=function(t){t.preventDefault(),a.props.form.validateFields(function(t,e){t||console.log("Received values of form: ",e)})},a.addShape=a.addShape.bind(Object(m.a)(a)),a.generateCode=a.generateCode.bind(Object(m.a)(a)),a.copyCode=a.copyCode.bind(Object(m.a)(a)),a.viewCode=a.viewCode.bind(Object(m.a)(a)),a.handerUndo=a.handerUndo.bind(Object(m.a)(a)),a.handerRedo=a.handerRedo.bind(Object(m.a)(a)),a.handerEditObject=a.handerEditObject.bind(Object(m.a)(a)),a.state={redoButtonStatus:"",undoButtonStatus:"",activeObjectOptions:{}},a.currentOptionArr=H,a.views=[],a.canvas_sprite="",a.shapes={text:[],rect:[],image:[],qrcode:[]},a.height=300,a.width=0,a.activeObject={},a}return Object(x.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){this.canvas_sprite=new fabric.Canvas("merge",this.currentOptionArr[0].css);var t=this;this.canvas_sprite.on("object:moving",function(t){var e=t.target;e.currentHeight>e.canvas.height||e.currentWidth>e.canvas.width||(e.setCoords(),(e.getBoundingRect().top<0||e.getBoundingRect().left<0)&&(e.top=Math.max(e.top,e.top-e.getBoundingRect().top),e.left=Math.max(e.left,e.left-e.getBoundingRect().left)),(e.getBoundingRect().top+e.getBoundingRect().height>e.canvas.height||e.getBoundingRect().left+e.getBoundingRect().width>e.canvas.width)&&(e.top=Math.min(e.top,e.canvas.height-e.getBoundingRect().height+e.top-e.getBoundingRect().top),e.left=Math.min(e.left,e.canvas.width-e.getBoundingRect().width+e.left-e.getBoundingRect().left)))}),this.canvas_sprite.on("mouse:down",function(e){e.target&&(t.activeObject=e.target,console.log("\u6709\u5bf9\u8c61\u88ab\u70b9\u51fb\u54af! ",e.target.type),t.activeObject.set({radius:150}))}),this.canvas_sprite.on("object:modified",function(){t.updateCanvasState()}),this.canvas_sprite.on("object:added",function(){t.updateCanvasState()}),this.addShape(1),this.addShape(2),this.addShape(3)}},{key:"beginEdit",value:function(t){this.activeObject&&(37===t.which?(t.preventDefault(),this.activeObject.set({left:this.activeObject.left-1})):39===t.which?(t.preventDefault(),this.activeObject.set({left:this.activeObject.left+1})):40===t.which?(t.preventDefault(),this.activeObject.set({top:this.activeObject.top+1})):38===t.which?(t.preventDefault(),this.activeObject.set({top:this.activeObject.top-1})):90===t.which?(t.preventDefault(),this.handerUndo()):89===t.which?(t.preventDefault(),this.handerRedo()):46===t.which&&(t.preventDefault(),this.canvas_sprite.remove(this.activeObject)),this.canvas_sprite.renderAll())}},{key:"addShape",value:function(){var t=Object(p.a)(u.a.mark(function t(e){var a,n,r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=this.currentOptionArr,n=a[e].type,t.t0=n,t.next="text"===t.t0?5:"rect"===t.t0?9:"image"===t.t0?13:"qrcode"===t.t0?17:21;break;case 5:return t.next=7,this.addTextObject(e);case 7:return r=t.sent,t.abrupt("break",22);case 9:return t.next=11,this.addRectObject(e);case 11:return r=t.sent,t.abrupt("break",22);case 13:return t.next=15,this.addImageObject(e);case 15:return r=t.sent,t.abrupt("break",22);case 17:return t.next=19,this.addQrcodeObject(e);case 19:return r=t.sent,t.abrupt("break",22);case 21:return t.abrupt("break",22);case 22:this.canvas_sprite.setActiveObject(r),this.shapes[n].push(r),this.canvas_sprite.add(r);case 25:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"addTextObject",value:function(){var t=Object(p.a)(u.a.mark(function t(e){var a,n,r,i,o,c,s,h,p,b,f,g,v,m,x,S,w,y,O,j,k,C,E,R,W,I,B,A,D,F,N,_,Y,X,z;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this,r=this.currentOptionArr,i=r[e].css,o=i.width,c=i.text,s=i.color,h=i.fontSize,p=i.left,b=i.top,f=i.fontWeight,g=i.fontFamily,v=i.padding,m=i.textDecoration,x=i.borderRadius,S=i.borderWidth,w=i.borderColor,y=i.rotate,O=i.shadow,j=i.lineHeight,k=i.textAlign,C=i.maxLines,E=i.textStyle,R=i.background,x/=1,S/=1,y/=1,C/=1,j/=1.08,a={width:(o/=1)/1,fill:s,fontWeight:f,left:p/=1,top:b/=1,fontSize:(h/=1)/1,fontFamily:g,padding:(v/=1)/1},Object(l.a)(a,m,!0),Object(l.a)(a,"textAlign",k),Object(l.a)(a,"textStyle",E),Object(l.a)(a,"shadow",O),Object(l.a)(a,"angle",y/1),Object(l.a)(a,"splitByGrapheme",!0),Object(l.a)(a,"zIndex",2),Object(l.a)(a,"lineHeight",j),Object(l.a)(a,"editable",!0),Object(l.a)(a,"maxLines",C/1),Object(l.a)(a,"textDecoration",m),Object(l.a)(a,"lockScalingY",!0),Object(l.a)(a,"mytype","textbox"),I=a,"stroke"===E&&(I=Object(d.a)({},I,{stroke:s,fill:"rgba(0,0,0)"})),(B=new fabric.Textbox(c,I)).textLines.length>C){for(A="",D=0;D<C;D++)F=B.textLines[D],D===C-1?A=A+F+"..":A+=F;B.set({text:A})}return S||R?(N=B.height/1+(B.lineHeight/1-1)*B.fontSize+2*v,_=B.width+2*v,Y=B.left-v,X=i.top-v,z=new fabric.Rect({width:_,height:N,left:Y,top:X,padding:v/1,rx:x/1,strokeWidth:S/1,stroke:w,fill:R,angle:y,shadow:O,backgroundColor:R,selectable:!1}),(W=new fabric.Group([z,B],{width:_,height:N,left:Y,top:X,angle:y,mytype:"textGroup"})).on("scaling",function(t){var e=this.width,a=this.height,r=this.width*this.scaleX,i=this.height*this.scaleY;z.set({left:-(r-e/2),top:-(i-a/2),height:i,width:r,rx:x,strokeWidth:S}),B.set({left:-(r-e/2),top:-(i-a/2),width:e,height:a,fontSize:h,scaleX:1,scaleY:1}),this.set({height:i,width:r,scaleX:1,scaleY:1,originX:"left"}),n.canvas_sprite.renderAll()})):W=B,t.abrupt("return",W);case 20:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"addRectObject",value:function(){var t=Object(p.a)(u.a.mark(function t(e){var a,n,r,i,o,c,s,d,l,h,p,b,f;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.currentOptionArr,n=a[e].css,r=n.width,i=n.height,o=n.left,c=n.top,s=n.borderRadius,d=n.borderWidth,l=n.borderColor,h=n.background,p=n.rotate,b=n.shadow,r/=1,i/=1,o/=1,c/=1,s/=1,d/=1,p/=1,f=new fabric.Rect({width:r,height:i,left:o,top:c,rx:s,strokeWidth:d,stroke:l,fill:h,rotate:p,shadow:b,mytype:"rect"}),t.abrupt("return",f);case 12:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"addImageObject",value:function(){var t=Object(p.a)(u.a.mark(function t(e){var a,n,r,i,o,c,s,d,l,h,p,b,f,g,v,m,x;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.currentOptionArr,n=a[e].css,r=n.width,i=n.height,o=n.left,c=n.top,s=n.borderRadius,d=n.borderWidth,l=n.borderColor,h=n.background,p=n.rotate,b=n.shadow,f=n.mode,g=n.url,r/=1,i/=1,o/=1,c/=1,s/=1,d/=1,p/=1,t.next=12,this.loadImageUrl(g);case 12:return v=t.sent,m=v.width,x=v.height,v.set({url:g,left:o/1,top:c/1,rx:s/1,ry:s/1,strokeWidth:d/1,stroke:l,backgroundColor:h,angle:p/1,mode:f,shadow:b,mytype:"image"}),"scaleToFill"===f?(v.set({width:m,height:x,scaleX:r/m,scaleY:i/x,oldScaleX:r/m,oldScaleY:i/x}),v.clipPath=new fabric.Rect({width:r,height:i,originX:"center",originY:"center",rx:s,angle:p/1,scaleX:m/r,scaleY:x/i})):"auto"===f?(v.set({width:m,height:x,scaleX:r/m,scaleY:r/m,oldScaleX:r/m,oldScaleY:i/x}),v.clipPath=new fabric.Rect({width:r,height:i,originX:"center",originY:"center",rx:s,angle:p/1,scaleX:m/r,scaleY:x/i})):"aspectFill"===f&&(v.clipPath=new fabric.Rect({width:r/1,height:i/1,originX:"center",originY:"center",rx:s/1,angle:p/1}),v.set({width:r,height:i})),t.abrupt("return",v);case 18:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"addQrcodeObject",value:function(){var t=Object(p.a)(u.a.mark(function t(e){var a,n,r,i,o,c,s,d,l,h,p;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.currentOptionArr,n=a[e].css,r=n.width,i=n.left,o=n.top,c=n.color,s=n.background,d=n.rotate,l=n.url,r/=1,i/=1,o/=1,d/=1,h=C.a.getQrBase64(l,{padding:0,width:r/1,height:r/1,correctLevel:L,reverse:!1,background:s,foreground:c}),t.next=10,this.loadImageUrl(h);case 10:return(p=t.sent).set({url:l,width:r/1,height:r/1,left:i/1,top:o/1,angle:d/1,lockUniScaling:!0,mytype:"qrcode"}),t.abrupt("return",p);case 13:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"loadImageUrl",value:function(t){return new Promise(function(e){fabric.Image.fromURL(t,function(t){e(t)})})}},{key:"clearCanvas",value:function(){this.rects.forEach(function(t,e){t.remove()}),this.texts.forEach(function(t,e){t.remove()})}},{key:"generateCode",value:function(){var t=this,e=this.shapes,a=this.canvas_sprite;this.views=[],Object.keys(e).forEach(function(a){e[a].forEach(function(e,a){var n={},r=e.oldScaleY||1,i={color:"".concat(e.color),background:"".concat(e.fill),width:"".concat(e.width*e.scaleX,"px"),height:"".concat(e.height*e.scaleY,"px"),top:"".concat(e.top,"px"),left:"".concat(e.left,"px"),rotate:"".concat(e.angle),borderRadius:"".concat(e.rx*(e.scaleY/r),"px"),borderWidth:"".concat(e.strokeWidth,"px"),borderColor:"".concat(e.stroke),shadow:"".concat(e.shadow)},o=e.mytype;"image"===o?(delete i.color,delete i.background,n={type:o,url:"".concat(e.url),css:Object(d.a)({},i,{mode:"".concat(e.mode)})}):"qrcode"===o?(delete i.color,delete i.background,delete i.borderRadius,delete i.borderWidth,delete i.borderColor,delete i.shadow,n={type:o,content:"".concat(e.url),css:Object(d.a)({},i)}):"textbox"===o?(delete i.borderRadius,delete i.borderWidth,delete i.borderColor,n={type:"text",text:"".concat(e.text),css:Object(d.a)({},i,{color:e.fill,padding:"".concat(e.padding,"px"),fontSize:"".concat(e.fontSize,"px"),fontWeight:"".concat(e.fontWeight),maxLines:"".concat(e.maxLines),lineHeight:"".concat(e.lineHeight/1*e.fontSize,"px"),textStyle:"".concat(e.textStyle),textDecoration:"".concat(e.textDecoration),fontFamily:"".concat(e.fontFamily),textAlign:"".concat(e.textAlign)})}):"textGroup"===o?e._objects.forEach(function(t){n="rect"===t.type?Object(d.a)({},n,{type:"text",css:Object(d.a)({},i,n.css,{left:"".concat(e.left+t.padding,"px"),top:"".concat(e.top+t.padding+t.strokeWidth,"px"),background:"".concat(t.backgroundColor),borderRadius:"".concat(t.rx,"px"),borderWidth:"".concat(t.strokeWidth,"px"),borderColor:"".concat(t.stroke)})}):Object(d.a)({},n,{type:"text",text:"".concat(t.text),css:Object(d.a)({},i,n.css,{width:"".concat(t.width,"px"),height:"".concat(t.height,"px"),color:t.fill,padding:"".concat(t.padding,"px"),fontSize:"".concat(t.fontSize,"px"),fontWeight:"".concat(t.fontWeight),maxLines:"".concat(t.maxLines),lineHeight:"".concat(1.08*t.lineHeight*t.fontSize,"px"),textStyle:"".concat(t.textStyle),textDecoration:"".concat("linethrough"===t.textDecoration?"line-through":t.textDecoration),fontFamily:"".concat(t.fontFamily),textAlign:"".concat(t.textAlign),shadow:"".concat(t.shadow)})})}):"rect"===o&&(delete i.color,0===e.strokeWidth&&(delete i.borderWidth,delete i.borderColor),n={type:o,css:Object(d.a)({},i,{color:e.fill})}),t.views.push(n)})}),this.finallObj={width:"".concat(a.width,"px"),height:"".concat(a.height,"px"),background:a.backgroundColor,views:this.views},this.miniCode="\n    export default class LastMayday {\n      palette() {\n        return (\n".concat(X.plain(this.finallObj).replace(/px/g,"px"),"\n        );\n      }\n    }\n    "),console.log("finallObj",X.plain(this.finallObj).replace(/px/g,"rpx"))}},{key:"copyCode",value:function(){this.generateCode(),F()(this.miniCode)?W.a.success("\u590d\u5236\u6210\u529f,\u8bf7\u8d76\u5feb\u53bbpainter\u7c98\u8d34\u4ee3\u7801\u67e5\u770b\u6548\u679c",2):W.a.error("\u590d\u5236\u5931\u8d25,\u8bf7\u91cd\u8bd5\u6216\u8005\u53bb\u8c37\u6b4c\u6d4f\u89c8\u5668\u5c1d\u8bd5",2)}},{key:"viewCode",value:function(){this.generateCode(),this.setState({visibleCode:!0})}},{key:"updateCanvasState",value:function(){var t=this.canvas_sprite;if(!1===U.undoStatus&&!1===U.redoStatus){var e=t.toJSON(),a=JSON.stringify(e);if(U.currentStateIndex<U.canvasState.length-1){var n=U.currentStateIndex+1;U.canvasState[n]=a;var r=n+1;U.canvasState=U.canvasState.splice(0,r)}else U.canvasState.push(a);U.currentStateIndex=U.canvasState.length-1,U.currentStateIndex===U.canvasState.length-1&&-1!==U.currentStateIndex&&this.setState({redoButtonStatus:"disabled"})}}},{key:"handerUndo",value:function(){var t=this,e=this.canvas_sprite;U.undoFinishedStatus&&(-1===U.currentStateIndex?U.undoStatus=!1:U.canvasState.length>=1&&(U.undoFinishedStatus=0,0!==U.currentStateIndex?(U.undoStatus=!0,e.loadFromJSON(U.canvasState[U.currentStateIndex-1],function(){e.renderAll(),U.undoStatus=!1,U.currentStateIndex-=1,t.setState({undoButtonStatus:""}),U.currentStateIndex!==U.canvasState.length-1&&t.setState({redoButtonStatus:""}),U.undoFinishedStatus=1})):0===U.currentStateIndex&&(e.clear(),U.undoFinishedStatus=1,t.setState({redoButtonStatus:"",undoButtonStatus:"disabled"}),U.currentStateIndex-=1)))}},{key:"handerRedo",value:function(){var t=this,e=this.canvas_sprite;U.redoFinishedStatus&&(U.currentStateIndex===U.canvasState.length-1&&-1!==U.currentStateIndex?t.setState({redoButtonStatus:"disabled"}):U.canvasState.length>U.currentStateIndex&&0!==U.canvasState.length&&(U.redoFinishedStatus=0,U.redoStatus=!0,e.loadFromJSON(U.canvasState[U.currentStateIndex+1],function(){e.renderAll(),U.redoStatus=!1,U.currentStateIndex+=1,-1!==U.currentStateIndex&&t.setState({undoButtonStatus:""}),U.redoFinishedStatus=1,U.currentStateIndex===U.canvasState.length-1&&-1!==U.currentStateIndex&&t.setState({redoButtonStatus:"disabled"})})))}},{key:"handerEditObject",value:function(){var t=this.canvas_sprite;this.activeObject=t.getActiveObject(),this.showDrawer(),console.log("this.activeObject",this.activeObject),this.setState({activeObjectOptions:{top:"",left:"",width:"",height:"",rotate:"",borderRadius:10,borderWidth:2,borderColor:"#000000",color:"",background:"",shadow:"",text:"",fontSize:"30",fontWeight:"bold",maxLines:"",lineHeight:"20",padding:"10",textDecoration:["none","overline","underline","linethrough"]}})}},{key:"render",value:function(){var t=this,e=this.currentOptionArr,a=this.state.visibleCode;return r.a.createElement("div",{id:"main"},r.a.createElement("div",{className:"slide"},r.a.createElement("canvas",{id:"merge",width:"700",height:"1000"})),r.a.createElement("div",{className:"main-container"},r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"btns"},r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:this.handerUndo},"Undo")),r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:this.handerRedo},"Redo")),r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:this.handerEditObject},"\u7f16\u8f91\u5bf9\u8c61")),r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:this.copyCode},"\u590d\u5236\u4ee3\u7801")),r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:this.viewCode},"\u67e5\u770b\u4ee3\u7801"))),r.a.createElement("div",{className:"code"})),r.a.createElement("div",{className:"option"},E.map(function(a,n){return 0===n?null:r.a.createElement("div",{key:n,className:"option-li"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"h3"},a.name," "),r.a.createElement("div",{className:"btn"},r.a.createElement(I.a,{type:"primary",onClick:t.addShape.bind(t,n)},"\u6dfb\u52a0"))),Object.keys(a.css).map(function(t,i){return r.a.createElement("div",{className:"row",key:i},r.a.createElement("div",{className:"h3"},t," "),!j.a.isArray(a.css[t])&&r.a.createElement(B.a,{defaultValue:a.css[t],onChange:function(a){e[n].css[t]=a.target.value}}),j.a.isArray(a.css[t])&&r.a.createElement(R.a,{defaultValue:a.css[t][0],style:{width:120},onChange:function(a){e[n].css[t]=a}},a.css[t].map(function(t,e){return r.a.createElement(z,{value:t,key:e},t)})))}))}))),r.a.createElement(A.a,{title:"view code",visible:a,onCancel:function(){t.setState({visibleCode:!1})},footer:[r.a.createElement(I.a,{key:"submit",type:"primary",onClick:this.copyCode},"\u590d\u5236\u4ee3\u7801")]},r.a.createElement(Y.a,{source:"```\n".concat(this.miniCode,"\n          ")})))}}]),e}(r.a.Component),Object(S.a)(s.prototype,"beginEdit",[c],Object.getOwnPropertyDescriptor(s.prototype,"beginEdit"),s.prototype),s);o.a.render(r.a.createElement("div",null,r.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[134,1,2]]]);
//# sourceMappingURL=main.eed30efc.chunk.js.map